#!/bin/bash

KITTY_TITLE="kitty_dropdown"

# 1. Search for the window ID (WID) with the unique title
WID=$(bspc query -N -n .window.local -d focused | while read -r nid; do
    if xdotool getwindowname "$nid" 2>/dev/null | grep -q "$KITTY_TITLE"; then
        echo "$nid"
        break
    fi
done)

# 2. Toggle the window state
if [ -n "$WID" ]; then
    # Window exists: Toggle hidden state (unmanage/manage)
    bspc node "$WID" -g hidden 
    
    # If the window is now visible, give it focus
    if bspc query -N -n "$WID" -d focused | grep -q "$WID"; then
        # bspc node "$WID" -f
        bspc node "$WID" -f -t state=fullscreen
    fi
else
    # Window does NOT exist: Launch Kitty with specific title
    # kitty --title "$KITTY_TITLE" --class "GuakeKitty" --start-as=fullscreen &
    kitty --title "$KITTY_TITLE" --class "GuakeKitty" --hold --detach --start-as=fullscreen &

    # Wait briefly for Kitty to launch before moving/sizing it (optional, but safer)
    sleep 0.2
fi
